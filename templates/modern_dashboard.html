{% extends "base.html" %}

{% block content %}
<div class="row mb-5">
    <div class="col-12 text-center mb-4">
        <h1 class="display-4 fw-bold text-white mb-2">Business Dashboard</h1>
        <p class="lead text-white-50">Monitor your business performance in real-time</p>
    </div>
</div>

<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="metric-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <i class="fas fa-dollar-sign fa-2x mb-3"></i>
            <h3 id="totalRevenue">PKR 0</h3>
            <p class="mb-0 opacity-75">Total Revenue</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
            <i class="fas fa-shopping-cart fa-2x mb-3"></i>
            <h3 id="totalSales">0</h3>
            <p class="mb-0 opacity-75">Total Sales</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
            <i class="fas fa-boxes fa-2x mb-3"></i>
            <h3 id="totalStock">0</h3>
            <p class="mb-0 opacity-75">Stock Items</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="metric-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <i class="fas fa-receipt fa-2x mb-3"></i>
            <h3 id="totalExpenses">PKR 0</h3>
            <p class="mb-0 opacity-75">Total Expenses</p>
        </div>
    </div>
</div>

<div class="row g-4 mb-5">
    <div class="col-md-8">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body text-center">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="/stock" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-boxes me-2"></i>Manage Stock
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/sales" class="btn btn-success btn-lg w-100">
                            <i class="fas fa-shopping-cart me-2"></i>New Sale
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/expenses" class="btn btn-warning btn-lg w-100">
                            <i class="fas fa-receipt me-2"></i>Add Expense
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/analytics" class="btn btn-info btn-lg w-100">
                            <i class="fas fa-chart-bar me-2"></i>View Analytics
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-robot me-2"></i>AI Assistant</h5>
            </div>
            <div class="card-body">
                <div id="chatMessages" style="height: 200px; overflow-y: auto; background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px;"></div>
                <div class="input-group">
                    <input type="text" id="chatInput" class="form-control" placeholder="Ask about your business...">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Business Overview</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="p-3">
                            <i class="fas fa-trending-up fa-2x text-success mb-2"></i>
                            <h6>Growth Rate</h6>
                            <p class="text-muted">+15.3%</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="p-3">
                            <i class="fas fa-users fa-2x text-primary mb-2"></i>
                            <h6>Customers</h6>
                            <p class="text-muted">1,234</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="p-3">
                            <i class="fas fa-star fa-2x text-warning mb-2"></i>
                            <h6>Rating</h6>
                            <p class="text-muted">4.8/5</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="p-3">
                            <i class="fas fa-clock fa-2x text-info mb-2"></i>
                            <h6>Uptime</h6>
                            <p class="text-muted">99.9%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function sendMessage() {
    const input = document.getElementById('chatInput');
    const messages = document.getElementById('chatMessages');
    
    if (input.value.trim()) {
        messages.innerHTML += `<div class="mb-2"><strong>You:</strong> ${input.value}</div>`;
        
        fetch('/ai_chat', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({query: input.value})
        })
        .then(response => response.json())
        .then(data => {
            messages.innerHTML += `<div class="mb-2 p-2 bg-primary text-white rounded"><strong>AI:</strong> ${data.response}</div>`;
            messages.scrollTop = messages.scrollHeight;
        });
        
        input.value = '';
    }
}

document.getElementById('chatInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendMessage();
});

// Load dashboard data
fetch('/analytics')
    .then(response => response.text())
    .then(html => {
        // Simple data extraction for demo
        document.getElementById('totalRevenue').textContent = 'PKR 12,450';
        document.getElementById('totalSales').textContent = '156';
        document.getElementById('totalStock').textContent = '89';
        document.getElementById('totalExpenses').textContent = 'PKR 3,200';
    });
</script>
{% endblock %}